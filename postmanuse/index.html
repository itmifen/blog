<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />

    

    

    <title>你应该学会的接口调试神器——Postman高级用法！ | IT米粉</title>
    <meta name="author" content="[object Object]" />
    <meta name="version" content="1.0.0" />
    <meta name="keywords" content="IT米粉,架构,spring cloud,程序员,数据库" />
    <meta name="description" content="
postman这个神器相信大家都用过，程序员作为非专业的测试人员，非常需要这么一款简单轻量级的restful测试工具，但是不知道你是否知道，postman的强大之处不只是测试一下接口，还有其他非常赞的使用方式。

批量执行接口入门级功能，但是被很多人忽略。postman左侧有个collections的tab,可以将接口进行分组，而且可以将分组以后的接口进行批量的执行，是一个非常赞的功能。当然，点击Runner也是可以的。
 

批量执行入口 



批量执行界面 


可以设置环境、重复次数、" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
    <!-- <meta name="baidu-site-verification" content="F0CXvmUgA9" /> -->

    
    
    <link rel="icon" href="/favicon.png">
    

    <link rel="stylesheet" href="/css/style.css">
</head>
<body>

    <div class="app">
        <header class="header clearfix">
    <div id="nav" class="nav">
    <button id="open-panel" class="open-panel"><i class="icon-library"></i></button>

    <nav class="nav-inner">

        
        
        <li class="nav-item">
            <a class="nav-link" href="/">首页</a>
        </li>
        
        
        
        <li class="nav-item nav-item-tag">
            <a id="nav-tag" class="nav-link" href="#">标签</a>
            <div id="nav-tags" class="nav-tag-wrap">
                <i class="nav-tag-arrow"></i>
                
  <div class="widget-wrap">
    <h3 class="widget-title">
        <i class="icon-tag vm"></i>
        <span class="vm">标签</span>
    </h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/net/">.net</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IT技术/">IT技术</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mac/">mac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/其他/">其他</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端/">前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库/">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/架构/">架构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/项目管理/">项目管理</a></li></ul>
    </div>
  </div>


            </div>
        </li>
        
        
        
        <li class="nav-item">
            <a class="nav-link" href="/archives">归档</a>
        </li>
        
        
        
        <li class="nav-item">
            <a class="nav-link" href="/about">关于</a>
        </li>
        
        
        

    </nav>
</div>

    <aside id="aside" class="aside">
    <div id="aside-mask" class="aside-mask"></div>
    <div id="aside-inner" class="aside-inner">
        <!-- <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"><i class="icon-search-stroke"></i></button><input type="hidden" name="sitesearch" value="http://www.17ij.com"></form> -->

        
        
        
        

        
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#批量执行接口"><span class="toc-number">1.</span> <span class="toc-text">批量执行接口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#认证authorization"><span class="toc-number">2.</span> <span class="toc-text">认证authorization</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#环境变量"><span class="toc-number">3.</span> <span class="toc-text">环境变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#执行前脚本"><span class="toc-number">4.</span> <span class="toc-text">执行前脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#测试脚本"><span class="toc-number">5.</span> <span class="toc-text">测试脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#调试"><span class="toc-number">6.</span> <span class="toc-text">调试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">7.</span> <span class="toc-text">总结</span></a></li></ol>
        
    </div>
</aside>

</header>

        <div id="content" class="content"><article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            你应该学会的接口调试神器——Postman高级用法！
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="/postmanuse/">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2018-05-26T22:00:00.000Z" itemprop="datePublished">2018-05-27</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/架构/">架构</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <blockquote>
<p>postman这个神器相信大家都用过，程序员作为非专业的测试人员，非常需要这么一款简单轻量级的restful测试工具，但是不知道你是否知道，postman的强大之处不只是测试一下接口，还有其他非常赞的使用方式。</p>
</blockquote>
<h2 id="批量执行接口"><a href="#批量执行接口" class="headerlink" title="批量执行接口"></a>批量执行接口</h2><p>入门级功能，但是被很多人忽略。postman左侧有个collections的tab,可以将接口进行分组，而且可以将分组以后的接口进行批量的执行，是一个非常赞的功能。当然，点击Runner也是可以的。</p>
<a id="more"></a> 
<ul>
<li>批量执行入口 </li>
</ul>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fle8n8bdxxj30ll0b2jsi.jpg" alt=""></p>
<ul>
<li>批量执行界面 </li>
</ul>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fle8v9g5e8j30lu0mh40t.jpg" alt=""></p>
<p>可以设置<strong>环境</strong>、<strong>重复次数</strong>、每个<strong>接口延迟</strong>等，并且会显示批量执行的结果。</p>
<p>这个是非常基础的功能，有了这个基础以后，批量的测试以及自动化的测试都可以实现。</p>
<h2 id="认证authorization"><a href="#认证authorization" class="headerlink" title="认证authorization"></a>认证authorization</h2><p>接口认证是所有接口必须做的事情，postman已经帮我们帮一些常用的接口认证机制可视化了，使用起来非常简单。<br>加入需要用的基础的auth认证，不管是auth1.0,还是auth2.0都能很好的支持。  </p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fle90wvrs8j30vm0cqjsn.jpg" alt=""></p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fle91kpdrqj30r00gddh9.jpg" alt=""></p>
<p>当然，有的时候认证方式完全是自定义的，在authorization功能找不到认证的方式,例如很多的身份认证是需要通过时间戳、密码或者其他参数根据一定的算法规则，算出一个结果，那么是不是我们就没有办法使用了？当然不是，那就需要重点介绍的功能——postman脚本，但这之前，我们先介绍一下还有一个非常重要的概念：环境变量   </p>
<h2 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h2><p>对于一个程序员来说，环境变量这个概念还是很好理解，这里的环境变量就是大家理解的那样了，设置了环境变量以后，所有的接口都可以使用这个变量，而且这个变量是可以通过代码进行修改的。<br>设置环境变量：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">postman.setEnvironmentVariable(<span class="string">"sign"</span>, mdmauth.toString());</span><br></pre></td></tr></table></figure></p>
<p>使用如上环境变量，只要在参数中用，如图：   </p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fln3j0erk8j31kw0h3wgz.jpg" alt="">  </p>
<h2 id="执行前脚本"><a href="#执行前脚本" class="headerlink" title="执行前脚本"></a>执行前脚本</h2><p>postman界面有个名叫pre-request script 的tab，从这里开始就介绍一下postman最重要的功能之一，脚本功能。pre-request script就是在请求之前执行的脚本。<br><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fln5daid2sj31dq03uwf3.jpg" alt=""><br>执行前脚本我一般的用法就是用来修改环境变量，因为执行前做的事情，主要就是对请求的参数做一些处理。这里举个简单的例子：<br>某接口的接口认证规则，主要是通过header中的authentication来进行身份的认证，authentication的值是根据秘钥（key）,时间戳（timeStamp），传入的参数（param），以及key、timeStamp和param组成生成字符串md5以后生成的sign，最终的结果类似于：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;"timeStamp": "2017-11-13 10:06:08",sign": "99f8d869d6a105afddd9d152c5894418"&#125;</span><br></pre></td></tr></table></figure></p>
<p>其实这是一个很常用场景，很多接口都是当前的参数和时间戳联合进行处理，来确保接口参数时效性，这样的场景直接通过参数或者环境变量肯定是有问题的，因为时间是动态的，只能动过程序来处理。我来处理方式大概就是：  </p>
<ul>
<li>脚本计算出需要的值，将值设为环境变量  </li>
<li>参数设置的value为当前的环境变量 </li>
<li>执行测试  </li>
</ul>
<p>脚本如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">var</span> date=<span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"> <span class="keyword">var</span> y = date.getFullYear();  </span><br><span class="line"> <span class="keyword">var</span> m = date.getMonth() + <span class="number">1</span>;  </span><br><span class="line">m = m &lt; <span class="number">10</span> ? (<span class="string">'0'</span> + m) : m;  </span><br><span class="line"><span class="keyword">var</span> d = date.getDate();  </span><br><span class="line">d = d &lt; <span class="number">10</span> ? (<span class="string">'0'</span> + d) : d;  </span><br><span class="line"><span class="keyword">var</span> h = date.getHours();  </span><br><span class="line">h=h &lt; <span class="number">10</span> ? (<span class="string">'0'</span> + h) : h;  </span><br><span class="line"><span class="keyword">var</span> minute = date.getMinutes();  </span><br><span class="line">minute = minute &lt; <span class="number">10</span> ? (<span class="string">'0'</span> + minute) : minute;  </span><br><span class="line"><span class="keyword">var</span> second=date.getSeconds();  </span><br><span class="line">second=second &lt; <span class="number">10</span> ? (<span class="string">'0'</span> + second) : second;  </span><br><span class="line">     </span><br><span class="line"><span class="comment">//获取时间，格式为yyyy-mm-dd HH:mm:ss                </span></span><br><span class="line"><span class="keyword">var</span> timespan=y + <span class="string">'-'</span> + m + <span class="string">'-'</span> + d+<span class="string">' '</span>+h+<span class="string">':'</span>+minute+<span class="string">':'</span>+second;</span><br><span class="line"><span class="keyword">var</span> key=<span class="string">'dfc96ds8-e5a0-45aa-a2ec-2611cds71d4e'</span>;</span><br><span class="line"><span class="comment">//通过request.data获取body的内容，这个是postman内置变量</span></span><br><span class="line"><span class="keyword">var</span> param=request.data;</span><br><span class="line">  <span class="built_in">console</span>.log(key);</span><br><span class="line">  <span class="built_in">console</span>.log(timespan);</span><br><span class="line">   <span class="built_in">console</span>.log(param);</span><br><span class="line"><span class="comment">//CryptoJS,postman的内置js库</span></span><br><span class="line"><span class="keyword">var</span> sign=CryptoJS.MD5(key+timespan+param).toString();</span><br><span class="line">  </span><br><span class="line"><span class="built_in">console</span>.log(sign);</span><br><span class="line"><span class="keyword">var</span> mdmauth=<span class="string">"&#123;\"timeStamp\": \""</span>+timespan+<span class="string">"\",\"sysCode\": \"EUH\",\"sign\": \""</span>+sign+<span class="string">"\"&#125;"</span>;  </span><br><span class="line"><span class="built_in">console</span>.log(mdmauth);</span><br><span class="line"><span class="comment">//设置环境变量</span></span><br><span class="line">postman.setEnvironmentVariable(<span class="string">"mdmauth"</span>, mdmauth.toString());</span><br></pre></td></tr></table></figure></p>
<p>postman的脚本是大家非常熟悉的javascript脚本，而且postman还内置了一些重用的js库，基本能满足所有的使用场景，我们常用内置的函数包括：  </p>
<ul>
<li>Lodash，一个基础的函数库，大家应该都用过</li>
<li>cheerio，可以理解为另一个jquery</li>
<li>BackboneJS,js的mvc框架</li>
<li>CryptoJS，js加密库，支持几乎所有的常用加密方式</li>
</ul>
<p>使用过程中我们也需要获取请求的值，或者请求的结果，post有几个内置的变量可以直接获取：</p>
<ul>
<li>request 获取请求的参数，包括头和请求体</li>
<li>responseHeaders 返回值的header</li>
<li>responseBody 返回值的body</li>
<li>responseCode 返回值的http code</li>
</ul>
<p>除此之外，还有几个内置的全局动态环境变量：  </p>
<ul>
<li>: 生成一个guid</li>
<li>: 获取当前时间戳</li>
<li>: 获取一个动态整数 </li>
</ul>
<p>说真的，postman考虑的是在是太周到了，有了以上的神器，不只是可以自动化的编写脚本，而且还能非常方便的编写脚本，测试任何类型的接口。<br>具体内容，建议详细阅读：<a href="https://www.getpostman.com/docs/postman/scripts/postman_sandbox" target="_blank" rel="noopener">https://www.getpostman.com/docs/postman/scripts/postman_sandbox</a>  ，这个页面的内容非常重要。  </p>
<h2 id="测试脚本"><a href="#测试脚本" class="headerlink" title="测试脚本"></a>测试脚本</h2><p>前文介绍了批量执行接口，执行前脚本能相关内容，只要能支持编程，接口的测试就变得很灵活，容易定制。其实，正常的测试还有一个场景，接口的测试都是有依赖的，如接口的测试都依赖于token接口来获取脚本，或者批量测试的时候，后面的接口需要前面接口的返回值等，postman肯定也是支持的，批量执行接口结合测试脚本，使用就非常简单了。<br>测试的代码在Test这个tab中，这里的结果是测试完成后执行的内容。pre-request script是执行前，test是执行后，这样就能构成一个闭环了。（完美！！！）<br><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fln5dn8uw2j31kw04zmy8.jpg" alt=""><br>示例代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jsonData = <span class="built_in">JSON</span>.parse(responseBody);</span><br><span class="line"></span><br><span class="line"><span class="comment">//tests的内容会在测试的时候展示</span></span><br><span class="line">tests[<span class="string">"http code"</span>] = responseCode.code === <span class="number">200</span>;</span><br><span class="line">tests[<span class="string">"返回值正常"</span>] = jsonData.Result===<span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">postman.setEnvironmentVariable(<span class="string">"authtoken"</span>,CryptoJS.MD5(request.headers[<span class="string">"UserName"</span>]+jsonData.Data.FranchiseeCode));</span><br><span class="line"></span><br><span class="line"><span class="comment">//执行成功后调用下一个接口</span></span><br><span class="line">postman.setNextRequest(<span class="string">"获取待处理"</span>);</span><br></pre></td></tr></table></figure></p>
<p>其中，有个函数postman.setNextRequest 会调用下一个接口，这两就可以让接口执行的有顺序，这就是我们需要的流程测试。  </p>
<h2 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h2><p>既然涉及到编程，那么肯定也会涉及到调试，postman对调试的支持也是非常好的，只需要简单的设置，结合chrome就能进行调试。<br>首先，开启下chrome的调试。在chrome地址栏中输入：chrome://flags/#debug-packed-apps ，开启Debugging for packed app。（设置栏目较多，建议搜索找到）<br><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fln5i1yxa3j31kw0ctjvr.jpg" alt=""></p>
<p>接着，输入chrome://inspect/#apps，选择postman的inspect，就弹出我们熟悉的postman的调试框<br><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fln5j3i1c9j31ag09ign9.jpg" alt="">  </p>
<p>我们在postman中的console.log或者断点都是可以进行调试的，和chrome调试web一样的。  </p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以上只是介绍了部分关于postman使用中，稍微高级一点的功能，其实postman还有很多好的功能，如文档导出、纯脚本测试，这些功能如果大家有用到，建议仔细阅读官网的doc，postman绝对不是简单的一个测试接口的工具，是一个完全覆盖开发人员测试场景的接口调试工具。</p>
<p>（完）</p>
<hr>
<p>欢迎大家关注我的公众号交流、学习、第一时间获取最新的文章。<br>微信号：itmifen  </p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fjqwqm6v25j30760760t7.jpg" alt=""></p>

        
    </section>
</article>



</div>
        <footer class="footer">
    <a href="http://www.beian.gov.cn/portal/index.do">粤ICP备18035917号-1</a>
</footer>


    </div>

    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/1.9.0/jquery.min.js"></script>
    
    <script type="text/javascript" src="/js/scrollspy.min.js"></script>
    
    <script type="text/javascript">
        $(function() {
            var nodes = {
                nav: $('#nav'),
                aside: $('#aside'),
                navTags: $('#nav-tags')
            };

            $('#open-panel, #aside-mask').on('click', function() {
                nodes.aside.toggleClass('panel-show');
            });
            $('#nav-tag').on('click', function(event) {
                event.preventDefault();console.log(nodes.navTags.attr('class'))
                nodes.navTags.toggleClass('tag-show');console.log(nodes.navTags.attr('class'))
            })/*.hover(function() {
                nodes.navTags.addClass('tag-show');
            }, function() {
                nodes.navTags.removeClass('tag-show');
            });*/

            
            $(document.body).scrollspy({target: '#aside-inner'});
            
        });
    </script>

</body>
</html>
